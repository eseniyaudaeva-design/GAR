–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Å–≤–µ—â–µ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫–æ–º —Å–≤–µ—Ç–∞ –∫–∞–∫ —É–ª.
–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∞–Ω–¥—ã –∫–∞–∫ –ü–î
–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ—Å—Ç–æ–ª–∫–æ–≤—ã–π –∫–∞–∫ –Ω–∞–ø—Ä–∏–º–µ—Ä
–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
–æ—Ç –±—Å4 –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ö—Ä–∞—Å–∏–≤–∞—è–°—É–ø
–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ
–æ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ü—Ä–∏–ª–∞–≤–æ–∫
–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞
–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä—è—Ç—å
–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å concurrent.futures
–æ—Ç urllib.parse –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å urlparse

# ==========================================
# 1. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# ==========================================
st.set_page_config(–º–∞–∫–µ—Ç="—à–∏—Ä–æ–∫–∏–π", –∑–∞–≥–æ–ª–æ–≤–æ–∫_—Å—Ç—Ä–∞–Ω–∏—Ü—ã="–ì–ê–† –ü–†–û", –∑–Ω–∞—á–æ–∫_—Å—Ç—Ä–∞–Ω–∏—Ü—ã="üìä")

# –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–∞–µ–º—ã—Ö –¥–æ–º–µ–Ω–æ–≤
DEFAULT_EXCLUDE_DOMAINS = [
    "yandex.ru", "avito.ru", "beru.ru", "tiu.ru", "aliexpress.com", "ebay.com",
    "auto.ru", "2gis.ru", "sravni.ru", "toshop.ru", "price.ru", "pandao.ru",
    "instagram.com", "wikipedia.org", "rambler.ru", "hh.ru", "banki.ru", 
    "regmarkets.ru", "zoon.ru", "pulscen.ru", "prodoctorov.ru", "blizko.ru", 
    "domclick.ru", "satom.ru", "quto.ru", "edadeal.ru", "cataloxy.ru", 
    "irr.ru", "onliner.by", "shop.by", "deal.by", "yell.ru", "profi.ru", 
    "irecommend.ru", "otzovik.com", "ozon.ru", "ozon.by", "market.yandex.ru", 
    "youtube.com", "gosuslugi.ru", "dzen.ru", "2gis.by"
]
DEFAULT_EXCLUDE = "\n".join(DEFAULT_EXCLUDE_DOMAINS)
DEFAULT_STOPS = "—Ä—É–±–ª–µ–π\n—Ä—É–±\n–∫—É–ø–∏—Ç—å\n—Ü–µ–Ω–∞\n—à—Ç\n—Å–º\n–º–º\n–∫–≥\n–∫–≤\n–º2\n—Å—Ç—Ä\n—É–ª"

# –°–ø–∏—Å–æ–∫ —Ä–µ–≥–∏–æ–Ω–æ–≤ –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏
–†–ï–ì–ò–û–ù–´ = [
    "–ú–æ—Å–∫–≤–∞", "–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥", "–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥", "–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫", "–ö–∞–∑–∞–Ω—å", 
    "–ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥", "–°–∞–º–∞—Ä–∞", "–ß–µ–ª—è–±–∏–Ω—Å–∫", "–û–º—Å–∫", "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä", 
    "–ö–∏–µ–≤ (UA)", "–ú–∏–Ω—Å–∫ (BY)", ¬´–ê–ª–º–∞—Ç—ã (–ö–ó)¬ª
]

# –¶–≤–µ—Ç–∞
PRIMARY_COLOR = "#277EFF"    # –°–∏–Ω–∏–π –∞–∫—Ü–µ–Ω—Ç
PRIMARY_DARK = "#1E63C4"     # –¢–µ–º–Ω—ã–π —Å–∏–Ω–∏–π
–¢–ï–ö–°–¢_–¶–í–ï–¢ = "#3D4858"       # –¢–µ–º–Ω–æ-—Å–µ—Ä—ã–π (–û—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç)
LIGHT_BG_MAIN = "#–§–§–§–§–§–§"    # –ë–µ–ª—ã–π —Ñ–æ–Ω –ø–æ–ª–µ–π (–ò–ó–ú–ï–ù–ï–ù–û) 
BORDER_COLOR = "#E2E8F0"     # –¶–≤–µ—Ç —Ä–∞–º–∫–∏
DARK_BORDER = "#94a3b8"      # –¢–µ–º–Ω–∞—è —Ä–∞–º–∫–∞ –¥–ª—è –Ω–µ–≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ [cite: 3]
MAROON_DIVIDER = "#990000"   # –¢–µ–º–Ω–æ-–±–æ—Ä–¥–æ–≤—ã–π –¥–ª—è —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è [cite: 3]

# --- –î–û–ë–ê–í–õ–ï–ù–ò–ï/–ò–ó–ú–ï–ù–ï–ù–ò–ï CSS –î–õ–Ø –†–ï–®–ï–ù–ò–Ø –ó–ê–î–ê–ß–ò ---
—Å—Ç.—É—Ü–µ–Ω–∫–∞(–µ"""
   <—Å—Ç–∏–ª—å>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        :–∫–æ—Ä–µ–Ω—å {{
            --–æ—Å–Ω–æ–≤–Ω–æ–π-—Ü–≤–µ—Ç: {PRIMARY_COLOR};
            --—Ç–µ–∫—Å—Ç-—Ü–≤–µ—Ç: {TEXT_COLOR};
            --light-bg-main: {LIGHT_BG_MAIN};
            --border-color: {BORDER_COLOR};
        }}
        
        /* 1. –ë–ê–ó–û–í–´–ô –¢–ï–ö–°–¢ (–ß—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞–ª–∏—Å—å —à—Ä–∏—Ñ—Ç—ã) */
        html, body, .stApp {{
            font-family: 'Inter', sans-serif;
            background-color: #FFFFFF !important;
            color: {TEXT_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}
        
        h1, h2, h3, h4, h5, h6, p, li, label, .stMarkdown, div[data-testid="stMarkdownContainer"] p {{
            —Ü–≤–µ—Ç: {TEXT_COLOR} !important;
        }}

        .block-container {{
            padding-top: 1rem !important;
            padding-bottom: 2rem !important;
            max-width: 100% !important; 
        }}
        
        /* ======================================================= */
        /* –ü–û–õ–Ø –í–í–û–î–ê - –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–´–ô –°–ò–ù–ò–ô –§–û–ö–£–°                 */
        /* ======================================================= */
        
        /* –°—Ç–∏–ª—å –ø–æ–∫–æ—è. –¢–µ–ø–µ—Ä—å –≤—Å–µ –ø–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç LIGHT_BG_MAIN, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–∞–ª –±–µ–ª—ã–º */
        .stTextInput input, 
        .stTextArea textarea, 
        .stSelectbox div[data-baseweb="select"] > div {{
            color: {TEXT_COLOR} !–≤–∞–∂–Ω—ã–π;
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: {LIGHT_BG_MAIN} !–≤–∞–∂–Ω—ã–π;
            –≥—Ä–∞–Ω–∏—Ü–∞: —Å–ø–ª–æ—à–Ω–∞—è 1 –ø–∏–∫—Å–µ–ª—å {BORDER_COLOR} !important;
            border-radius: 6px;
        }}

        /* !!!
        –í–ê–ñ–ù–û: –°–ò–ù–ò–ô –§–û–ö–£–° !!! */
        /* –ú—ã –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ div —Å –∞—Ç—Ä–∏–±—É—Ç–æ–º data-baseweb, —ç—Ç–æ –ø–µ—Ä–µ–±–∏–≤–∞–µ—Ç –æ—Ä–∞–Ω–∂–µ–≤—ã–π —Ü–≤–µ—Ç Streamlit */
        
        /* –î–ª—è –æ–±—ã—á–Ω—ã—Ö –∏–Ω–ø—É—Ç–æ–≤ */
        div[data-baseweb="input"]:focus-within {{
            border-color: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            –∫–æ—Ä–æ–±–∫–∞-—Ç–µ–Ω—å: 0 0 0 1px {PRIMARY_COLOR} !important;
        }}
        
        /* –î–ª—è –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π (Textarea) */
        div[data-baseweb="textarea"]:focus-within {{
            border-color: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            –∫–æ—Ä–æ–±–∫–∞-—Ç–µ–Ω—å: 0 0 0 1px {PRIMARY_COLOR} !important;
        }}
        
        /* –î–ª—è —Å–µ–ª–µ–∫—Ç–æ–≤ */
        div[data-baseweb="select"] > div:focus-within {{
            border-color: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            –∫–æ—Ä–æ–±–∫–∞-—Ç–µ–Ω—å: 0 0 0 1px {PRIMARY_COLOR} !important;
        }}
        
        /* --- –ù–û–í–´–ô CSS: Selectbox Dropdown (Requirement 1) --- */
        /* –í—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ Selectbox */
        ul[data-testid="stSelectboxVirtualDropdown"] {
            background-color: #FFFFFF !important; /* –ë–µ–ª—ã–π —Ñ–æ–Ω –¥–ª—è —Å–ø–∏—Å–∫–∞ */
        }
        /* –¢–µ–∫—Å—Ç –æ–ø—Ü–∏–π –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ */
        ul[data-testid="stSelectboxVirtualDropdown"] li p {
            —Ü–≤–µ—Ç: {TEXT_COLOR} !important; /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –æ–ø—Ü–∏–π */
        }
        /* –û–ø—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        ul[data-testid="stSelectboxVirtualDropdown"] li:hover {
            background-color: #f0f0f0 !important; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
        }
        /* --- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û CSS --- */


        /* –£–±–∏—Ä–∞–µ–º –Ω–∞—Ç–∏–≤–Ω—É—é –æ–±–≤–æ–¥–∫—É –±—Ä–∞—É–∑–µ—Ä–∞ */
        .stTextInput input:focus,
        .stTextArea textarea:focus {{
            outline: none !important;
            border-color: transparent !important;
            box-shadow: none !important;
        }}
        
        /* –¶–≤–µ—Ç –∫—É—Ä—Å–æ—Ä–∞ –∏ —Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ */
        input, textarea {{
            caret-color: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            —Ü–≤–µ—Ç: {TEXT_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}
        
        /* –ó–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å */
        ::–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å {{
            —Ü–≤–µ—Ç: #94a3b8 !–≤–∞–∂–Ω–æ;
            –Ω–µ–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å: 1;
        }}
        
        /* –ò–∫–æ–Ω–∫–∏ Selectbox */
        .stSelectbox SVG {{
            –∑–∞–ø–æ–ª–Ω–∏—Ç—å: {TEXT_COLOR} !important;
        }}

        /* ======================================================= */
        /* –†–ê–î–ò–û –ò –ß–ï–ö–ë–û–ö–°–´                                        */
        /* ======================================================= */
        
        /* –†–∞–¥–∏–æ */
        div[role="radiogroup"] label {{
            background-color: #FFFFFF !important;
            border: 1px solid {BORDER_COLOR};
            margin-right: 5px;
        }}
        
        /* –¢–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ —Ä–∞–¥–∏–æ */
        div[role="radiogroup"] p {{
            color: {TEXT_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}
        
        div[role="radiogroup"] –º–µ—Ç–∫–∞ div[data-baseweb="radio"] > div {{
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: #FFFFFF !important;
            –≥—Ä–∞–Ω–∏—Ü–∞: —Å–ø–ª–æ—à–Ω–∞—è 2 –ø–∏–∫—Å–µ–ª—è {DARK_BORDER} !–≤–∞–∂–Ω—ã–π;
        }}
        –í–≤–æ–¥ –º–µ—Ç–∫–∏ div[role="radiogroup"]: –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ + div[data-baseweb="radio"] > div {{
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}
        –í–≤–æ–¥ –º–µ—Ç–∫–∏ div[role="radiogroup"]: –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ + div[data-baseweb="radio"] > div > div {{
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: #FFFFFF !important;
        }}
        div[role="radiogroup"] label:has(input:checked) {{
            —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}

        /* –ß–µ–∫–±–æ–∫—Å—ã */
        –º–µ—Ç–∫–∞ div[data-baseweb="checkbox"], div[data-baseweb="checkbox"] p {{
            —Ü–≤–µ—Ç: {TEXT_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}
        div[data-baseweb="checkbox"] > div:first-child {{
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: #FFFFFF !important;
            –≥—Ä–∞–Ω–∏—Ü–∞: —Å–ø–ª–æ—à–Ω–∞—è 2 –ø–∏–∫—Å–µ–ª—è {DARK_BORDER} !–≤–∞–∂–Ω—ã–π;
        }}
        div[data-baseweb="checkbox"] input:checked + div:first-child {{
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}
        div[data-baseweb="checkbox"] input:checked + div:first-child svg {{
            fill: #FFFFFF !–≤–∞–∂–Ω–æ;
        }}
        div[data-baseweb="checkbox"]:hover > div:first-child {{
            —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: {PRIMARY_COLOR} !important;
        }}
        
        /* --- –ù–û–í–´–ô CSS: Expander (Requirement 3 visual style) --- */
        /* –°—Ç–∏–ª—å –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ st.expander (–≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø–æ–ª–µ –≤–≤–æ–¥–∞) */
        div[data-testid="stExpander"] > div:first-child {
            /* –ü–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö —Å—Ç–∏–ª–µ–π Streamlit */
            background-color: #FFFFFF !important; 
            border: 1px solid {BORDER_COLOR} !important; 
            border-radius: 6px;
            padding: 0.5rem 1rem;
            margin-bottom: 1rem; /* –û—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */
        }
        /* –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–≤–µ—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Expander */
        div[data-testid="stExpander"] > div:first-child p {
            —Ü–≤–µ—Ç: {TEXT_COLOR} !–≤–∞–∂–Ω—ã–π; 
        }
        /* –§–æ–∫—É—Å –Ω–∞ —Ä–∞—Å—à–∏—Ä–∏—Ç–µ–ª–µ */
        div[data-testid="stExpander"] > div:first-child:focus-within {
            —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            –∫–æ—Ä–æ–±–∫–∞-—Ç–µ–Ω—å: 0 0 0 1px {PRIMARY_COLOR} !important;
        }
        /* –°—Ç–∏–ª—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ Expander */
        div[data-testid="stExpanderContent"] {
            –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ: 0 0 1—Ä–µ–º 0 !–≤–∞–∂–Ω—ã–π;
        }
        /* --- –ö–û–ù–ï–¶ –ù–û–í–û–ì–û CSS --- */

        /* ======================================================= */
        /* –ö–ù–û–ü–ö–ê                                                  */
        /* ======================================================= */
        .stButton button {{
           
            background-image: linear-gradient(to right, {PRIMARY_COLOR}, {PRIMARY_DARK});
            —Ü–≤–µ—Ç: –±–µ–ª—ã–π !–≤–∞–∂–Ω–æ;
            –≥—Ä–∞–Ω–∏—Ü–∞: –Ω–µ—Ç;
            –≤—ã—Å–æ—Ç–∞: 50 –ø–∏–∫—Å–µ–ª–µ–π;
        }}
        –ö–Ω–æ–ø–∫–∞ .stButton: —Ñ–æ–∫—É—Å {{
            —Ü–≤–µ—Ç –≥—Ä–∞–Ω–∏—Ü—ã: {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            –∫–æ—Ä–æ–±–∫–∞-—Ç–µ–Ω—å: 0 0 0 1px {PRIMARY_COLOR} !–≤–∞–∂–Ω—ã–π;
            —Ü–≤–µ—Ç: –±–µ–ª—ã–π !–≤–∞–∂–Ω–æ;
        }}
        –ö–Ω–æ–ø–∫–∞ .stButton p {{
            —Ü–≤–µ—Ç: –±–µ–ª—ã–π !–≤–∞–∂–Ω–æ;
        }}

        /* ==================================================== */
        /* –°–ê–ô–î–ë–ê–† */
        /* ==================================================== */
        .st-emotion-cache-1cpxwwu {{ 
            
            —à–∏—Ä–∏–Ω–∞: 65% !–≤–∞–∂–Ω–æ;
            –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞: 65% !–≤–∞–∂–Ω–æ;
        }}
        div[data-testid="column"]:nth-child(2) {{
            –ø–æ–∑–∏—Ü–∏—è: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è !–≤–∞–∂–Ω–æ;
            –ø—Ä–∞–≤–∏–ª—å–Ω–æ: 0 !–≤–∞–∂–Ω–æ;
            –≤–≤–µ—Ä—Ö—É: 0 !–≤–∞–∂–Ω–æ;
            —à–∏—Ä–∏–Ω–∞: 35% !–≤–∞–∂–Ω–æ; 
            –≤—ã—Å–æ—Ç–∞: 100vh !–≤–∞–∂–Ω–æ;
            –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ-y: –∞–≤—Ç–æ! –≤–∞–∂–Ω–æ; 
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: #FFFFFF !important;
            –æ—Ç—Å—Ç—É–ø: 1rem 1rem 2rem 1,5rem !–≤–∞–∂–Ω–æ; 
            z-–∏–Ω–¥–µ–∫—Å: 100;
            –∫–æ—Ä–æ–±–∫–∞-—Ç–µ–Ω—å: -1px 0 0 0 {MAROON_DIVIDER} –≤—Å—Ç–∞–≤–∫–∞; 
            –≥—Ä–∞–Ω–∏—Ü–∞ —Å–ª–µ–≤–∞: 1 –ø–∏–∫—Å–µ–ª—å, —Å–ø–ª–æ—à–Ω–∞—è {BORDER_COLOR};
        }}
        div[data-testid="column"]:nth-child(2).stSelectbox div[data-baseweb="select"] > div,
        div[data-testid="column"]:nth-child(2).stTextInput –≤–≤–æ–¥,
        div[data-testid="column"]:nth-child(2).stTextarea textarea {{
            —Ü–≤–µ—Ç —Ñ–æ–Ω–∞: {LIGHT_BG_MAIN} !–≤–∞–∂–Ω—ã–π;
            —Ü–≤–µ—Ç: {TEXT_COLOR} !–≤–∞–∂–Ω—ã–π;
            –≥—Ä–∞–Ω–∏—Ü–∞: —Å–ø–ª–æ—à–Ω–∞—è 1 –ø–∏–∫—Å–µ–ª—å {BORDER_COLOR} !–≤–∞–∂–Ω—ã–π;
        }}
        div[data-testid="column"]:nth-child(2) .stCaption {{ display: none;
        }}

    </—Å—Ç–∏–ª—å>
""", unsafe_allow_html=–ò—Å—Ç–∏–Ω–Ω—ã–π)

# ==========================================
# 2. –õ–û–ì–ò–ö–ê (–ë–≠–ö–ï–ù–î)
# ==========================================

–ø—ã—Ç–∞—Ç—å—Å—è:
    –µ—Å–ª–∏ –Ω–µ—Ç —Ö–∞—Å–∞—Ç—Ç—Ä(–ø—Ä–æ–≤–µ—Ä–∏—Ç—å, 'getargspec'):
        –∑–∞—â–∏—Ç–∞ getargspec(—Ñ—É–Ω–∫—Ü–∏—è):
            —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è = Inspect.getfullargspec(func)
            –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è spec.args, spec.varargs, spec.varkw, spec.defaults
        Inspect.getargspec = getargspec
    –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–∏–º–æ—Ä—Ñ–∏—è2
    –º–æ—Ä—Ñ = pymorphy2.MorphAnalyzer()
    USE_NLP = –ò—Å—Ç–∏–Ω–Ω—ã–π
–∫—Ä–æ–º–µ:
    –º–æ—Ä—Ñ = –ù–∏–∫—Ç–æ
    USE_NLP = –õ–û–ñ–¨

–ø—ã—Ç–∞—Ç—å—Å—è:
    –æ—Ç –≥—É–≥–ª–ø–æ–∏—Å–∫ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫
    USE_SEARCH = –ò—Å—Ç–∏–Ω–Ω—ã–π
–∫—Ä–æ–º–µ:
    USE_SEARCH = –õ–û–ñ–¨

–∑–∞—â–∏—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å_—Ç–µ–∫—Å—Ç(—Ç–µ–∫—Å—Ç, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, n_gram=1):
    —à–∞–±–ª–æ–Ω = r'[–∞-—è–ê-–Ø—ë–Å0-9a-zA-Z]+' –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏['—Ü–∏—Ñ—Ä—ã'] –µ—â–µ r'[–∞-—è–ê-–Ø—ë–Åa-zA-Z]+'
    —Å–ª–æ–≤–∞ = re.findall(—à–∞–±–ª–æ–Ω, text.lower())
    –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è = –Ω–∞–±–æ—Ä(—Å.–Ω–∏–∂–µ() –¥–ª—è –í –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏['custom_stops'])
    —á–∏—Å—Ç—ã–µ_—Å–ª–æ–≤–∞ = []
    
    –¥–ª—è –í –≤ —Å–ª–æ–≤–∞:
        –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ(–≤) < 2 –∏–ª–∏ –í –≤ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏: –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
        –ª–µ–º–º–∞ = —à
        –µ—Å–ª–∏ USE_NLP –∏ –Ω_–≥—Ä–∞–º–º == 1: 
            p = morph.parse(w)[0]
            –µ—Å–ª–∏ ¬´–ü–†–ï–ü¬ª –≤ –¥–µ–Ω—å –¥–Ω—è –∏–ª–∏ '–ö–û–ù–ñ' –≤ –¥–µ–Ω—å –¥–Ω—è –∏–ª–∏ '–ü–†–ö–õ' –≤ –¥–µ–Ω—å –¥–Ω—è –∏–ª–∏ '–ù–ü–†–û' –≤ –¥–µ–Ω—å: –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
            –ª–µ–º–º–∞ = p.normal_form
        clean_words.append(–ª–µ–º–º–∞)
    
    –µ—Å–ª–∏ –Ω_–≥—Ä–∞–º–º > 1:
        –Ω–≥—Ä–∞–º–º—ã = []
        –¥–ª—è —è –≤ –¥–∏–∞–ø–∞–∑–æ–Ω(—Ç–æ–ª—å–∫–æ(—á–∏—Å—Ç—ã–µ_—Å–ª–æ–≤–∞) - –Ω_–≥—Ä–∞–º–º + 1):
            —Ñ—Ä–∞–∑–∞ = " ".join(clean_words[i:i+n_gram])
            ngrams.append(—Ñ—Ä–∞–∑–∞)
        –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –Ω–≥—Ä–∞–º–º—ã
    –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è —á–∏—Å—Ç—ã–µ_—Å–ª–æ–≤–∞

–∑–∞—â–∏—Ç–∞ parse_page(URL, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏):
    –∑–∞–≥–æ–ª–æ–≤–∫–∏ = {'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–≥–µ–Ω—Ç': –Ω–∞—Å—Ç—Ä–æ–π–∫–∏['–¥–µ–ª–∞—Ç—å']}
    –ø—ã—Ç–∞—Ç—å—Å—è:
        r = Requests.get(url, –∑–∞–≥–æ–ª–æ–≤–∫–∏=–∑–∞–≥–æ–ª–æ–≤–∫–∏, —Ç–∞–π–º–∞—É—Ç=15)
        –µ—Å–ª–∏ r.status_code != 200: –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –ù–∏–∫—Ç–æ
        —Å—É–ø = BeautifulSoup(r.text, 'html.–ø–∞—Ä—Å–µ—Ä')
        
        –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏['–Ω–æ–∏–Ω–¥–µ–∫—Å']:
            –¥–ª—è —Ç –≤ —Å—É–ø.find_all(['–Ω–æ–∏–Ω–¥–µ–∫—Å', '—Å—Ü–µ–Ω–∞—Ä–∏–π', '—Å—Ç–∏–ª—å', '–≥–æ–ª–æ–≤–∞', '–Ω–∏–∂–Ω–∏–π –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª', '–Ω–µ—Ç']): t.decompose()
        –µ—â–µ:
            –¥–ª—è —Ç –≤ —Å—É–ø(['—Å—Ü–µ–Ω–∞—Ä–∏–π', '—Å—Ç–∏–ª—å', '–≥–æ–ª–æ–≤–∞']): t.decompose()
            
        —è–∫–æ—Ä—è_—Å–ø–∏—Å–æ–∫ = [a.get_text(strip=–ò—Å—Ç–∏–Ω–Ω—ã–π) –¥–ª—è –∞ –≤ —Å—É–ø.find_all('–∞') –µ—Å–ª–∏ a.get_text(strip=–ò—Å—Ç–∏–Ω–Ω—ã–π)]
        —è–∫–æ—Ä–Ω—ã–π_—Ç–µ–∫—Å—Ç = " ".join(—Å–ø–∏—Å–æ–∫_—è–∫–æ—Ä–µ–π)
      
        –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π_—Ç–µ–∫—Å—Ç = []
        –µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏['alt_title']:
            –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å—É–ø.find_all('img', –≤—Å–µ=–ò—Å—Ç–∏–Ω–Ω—ã–π): extra_text.append(img['–≤—Å–µ'])
            –¥–ª—è —Ç –≤ —Å—É–ø.find_all(title=–ò—Å—Ç–∏–Ω–Ω—ã–π): extra_text.append(t['–∑–∞–≥–æ–ª–æ–≤–æ–∫'])
        body_text = —Å—É–ø.get_text(—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å=' ') + " " + " ".join(extra_text)
        
        –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è {
            'URL-–∞–¥—Ä–µ—Å': URL, '–¥–æ–º–µ–Ω': urlparse(url).netloc, 
            'body_text': body_text, 'anchor_text': —è–∫–æ—Ä–Ω—ã–π_—Ç–µ–∫—Å—Ç
        }
    –∫—Ä–æ–º–µ: –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –ù–∏–∫—Ç–æ

–∑–∞—â–∏—Ç–∞ –≤—ã—á–∏—Å–ª–∏—Ç—å_–º–µ—Ç—Ä–∏–∫–∏(comp_data, –º–æ–∏_–¥–∞–Ω–Ω—ã–µ, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏):
    –µ—Å–ª–∏ –Ω–µ—Ç –º–æ–∏_–¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –Ω–µ—Ç –º–æ–∏_–¥–∞–Ω–Ω—ã–µ['body_text']:
        my_lemmas = []
        my_anchors = []
        my_len = 0
    –µ—â–µ:
        my_lemmas =process_text(my_data['body_text'], –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        my_anchors =process_text(my_data['anchor_text'], –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        my_len = —Ç–æ–ª—å–∫–æ(–º–æ–∏_–ª–µ–º–º—ã)
    
    –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã = []
    –¥–ª—è –ø –≤ –∫–æ–º–ø_–¥–∞–Ω–Ω—ã–µ:
        —Ç–µ–ª–æ = Process_text(p['body_text'], –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        —è–∫–æ—Ä—å = Process_text(p['anchor_text'], –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        comp_docs.append({'—Ç–µ–ª–æ': —Ç–µ–ª–æ, '—è–∫–æ—Ä—å': —è–∫–æ—Ä—å})
        
    –µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã:
        –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è {"–≥–ª—É–±–∏–Ω–∞": pd.DataFrame(), "–≥–∏–±—Ä–∏–¥–Ω—ã–π": pd.DataFrame(), "–Ω–≥—Ä–∞–º–º—ã": pd.DataFrame(), "relevance_top": pd.DataFrame(), "–º–æ–π_—Å—á–µ—Ç": {"—à–∏—Ä–∏–Ω–∞": 0, "–≥–ª—É–±–∏–Ω–∞": 0}}

    
    avg_len = np.mean([—Ç–æ–ª—å–∫–æ(–¥['—Ç–µ–ª–æ']) –¥–ª—è –¥ –≤ –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã])
    –Ω–æ—Ä–º_–∫ = (–º–æ–π_–ª–µ–Ω / avg_–ª–µ–Ω) –µ—Å–ª–∏ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏['–Ω–æ—Ä–º–∞'] –∏ avg_len > 0) –µ—â–µ 1.0
    
    —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å = –Ω–∞–±–æ—Ä(–º–æ–∏_–ª–µ–º–º—ã)
    –¥–ª—è –¥ –≤ comp_docs: vocab.update(d['—Ç–µ–ª–æ'])
    —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å = –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π(—Å–ø–∏—Å–æ–∫(—Å–ª–æ–≤–∞—Ä))
    
    –ù= —Ç–æ–ª—å–∫–æ(–∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã)
    doc_freqs = –°—á–µ—Ç—á–∏–∫()
    –¥–ª—è –¥ –≤ –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã:
        –¥–ª—è –í –≤ –Ω–∞–±–æ—Ä(–¥['—Ç–µ–ª–æ']): doc_freqs[w] += 1
        
    –∫1, –± = 1.2, 0.75
 
    table_–≥–ª—É–±–∏–Ω–∞, table_hybrid = [], []
    
    –¥–ª—è —Å–ª–æ–≤–æ –≤ —Å–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å:
        df = doc_freqs[—Å–ª–æ–≤–æ]
        –µ—Å–ª–∏ –¥—Ñ < 2 –∏ —Å–ª–æ–≤–æ –Ω–µ—Ç –≤ –º–æ–∏_–ª–µ–º–º—ã: –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å 
        
        my_tf = my_lemmas.count(—Å–ª–æ–≤–æ)
        my_anch_tf = my_anchors.count(—Å–ª–æ–≤–æ)
        
        c_body_tfs = [d['—Ç–µ–ª–æ'].count(—Å–ª–æ–≤–æ) –¥–ª—è –¥ –≤ –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã]
    
        c_anch_tfs = [d['—è–∫–æ—Ä—å'].count(—Å–ª–æ–≤–æ) –¥–ª—è –¥ –≤ –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã]
        
        med_tf = np.median(c_body_tfs)
        med_anch = np.median(c_anch_tfs)
        max_tf = –ù–ü.–ú–∞–∫—Å(c_body_tfs)
        
        idf = math.log((N - df + 0.5) / (df + 0.5) + 1)
        
        bm25_scores = []
      
        –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å(–∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã):
            tf = c_body_tfs[—è]
            –¥–ª = —Ç–æ–ª—å–∫–æ(–¥['—Ç–µ–ª–æ'])
            —Å—á–µ—Ç = idf * (tf * (k1 + 1)) / (tf + k1 * (1 - –±+–±*(–¥–ª/–∞–≤–≥_–ª–µ–Ω)))
            bm25_scores.append(–æ—Ü–µ–Ω–∫–∞)
        bm25_top = np.median(bm25_scores)
        
  
        bm25_my = 0
        –µ—Å–ª–∏ my_len > 0:
            bm25_my = idf * (my_tf * (k1 + 1)) / (my_tf + k1 * (1 - –±+–±*(–º–æ–π_–ª–µ–Ω/–∞–≤–≥_–ª–µ–Ω)))
        
        target_body = –∏–Ω—Ç–µ—Ä–≤–∞–ª(—Å_tf * 1.3 * –Ω–æ—Ä–º_–∫)
        diff_body = target_body - my_tf
        target_anch = –∏–Ω—Ç–µ—Ä–≤–∞–ª(–º–µ–¥_–∞–Ω—á *–Ω–æ—Ä–º_–∫)
 
        diff_anch = target_anch - my_anch_tf
        
        –µ—Å–ª–∏ —Å_tf > 0.5 –∏–ª–∏ –º–æ–π_—Ç—Ñ > 0:
            table_length.append({
                "–°–ª–æ–≤–æ": —Å–ª–æ–≤–æ, "–°–ª–æ–≤–æ—Ñ–æ—Ä–º—ã": —Å–ª–æ–≤–æ, "–ü–æ–≤—Ç–æ—Ä—ã —É –≤–∞—Å": –º–æ–π_—Ç—Ñ, 
                "–ú–∏–Ω–∏–º—É–º": –Ω–∞–ø—Ä–∏–º–µ—Ä–º–∏–Ω(c_body_tfs), "–ú–∞–∫—Å–∏–º—É–º": –∏–Ω—Ç–µ—Ä–≤–∞–ª(–º–∞–∫—Å_—Ç—Ñ * –Ω–æ—Ä–º–∞_–∫),
         
                "–û–±—â–µ–µ –î–æ–±–∞–≤–∏—Ç—å/–£–±—Ä–∞—Ç—å": diff_body,
                "–¢–µ–≥ A —É –≤–∞—Å": my_anch_tf, "–¢–µ–≥ A —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": target_anch,
                "–¢–µ–≥ A –î–æ–±–∞–≤–∏—Ç—å/–£–±—Ä–∞—Ç—å": diff_anch,
                "–¢–µ–∫—Å—Ç —É –≤–∞—Å": –º–æ–π_—Ç—Ñ, "–¢–µ–∫—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏": target_body, "–¢–µ–∫—Å—Ç –î–æ–±–∞–≤–∏—Ç—å/–£–±—Ä–∞—Ç—å": diff_body,
                "–ü–µ—Ä–µ—Å–ø–∞–º": –∏–Ω—Ç–µ—Ä–≤–∞–ª(–º–∞–∫—Å_—Ç—Ñ * –Ω–æ—Ä–º–∞_–∫), "–ü–µ—Ä–µ—Å–ø–∞–º*IDF": –∫—Ä—É–≥–ª—ã–π(max_tf*norm_k*idf, 1),
                "diff_abs": –ø—Ä–µ—Å—Å(diff_body)
            })
            table_hybrid.append({
                "–°–ª–æ–≤–æ": —Å–ª–æ–≤–æ, "TF-IDF –¢–û–ü": –∫—Ä—É–≥–ª—ã–π(med_tf *idf, 2), "TF-IDF –≤–∞—à —Å–∞–π—Ç": –∫—Ä—É–≥–ª—ã–π(my_tf *idf, 2),
                "BM25 –¢–û–ü": –∫—Ä—É–≥–ª—ã–π(bm25_top, 2), "BM25 –≤–∞—à —Å–∞–π—Ç": –∫—Ä—É–≥–ª—ã–π(bm25_my, 2), ¬´–¶–ê–•–ê–õ¬ª: –∫—Ä—É–≥–ª—ã–π(–ò–î–§, 2),
                "–ö–æ–ª-–≤–æ —Å–∞–π—Ç–æ–≤": –¥—Ñ, "–ú–µ–¥–∏–∞–Ω–∞": –∫—Ä—É–≥–ª—ã–π(—Å_—Ç—Ñ, 1), "–ü–µ—Ä–µ—Å–ø–∞–º": max_tf,
                "–°—Ä–µ–¥–Ω–µ–µ –ø–æ –¢–û–ü—É": –∫—Ä—É–≥–ª—ã–π(np.mean(c_body_tfs) –µ—Å–ª–∏ c_body_tfs –µ—â–µ 0, 1), ¬´–í–∞—à —Å–∞–π—Ç¬ª: –º–æ–π_—Ç—Ñ,
                "<a> –ø–æ –¢–û–ü—É": –∫—Ä—É–≥–ª—ã–π(—Å_–∞–Ω—á, 1), "<a> –≤–∞—à —Å–∞–π—Ç": my_anch_tf
            })

    table_ngrams = []
    –µ—Å–ª–∏ –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã:
  
        my_bi =process_text(my_data['body_text'], –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, 2) –µ—Å–ª–∏ –º–æ–∏_–¥–∞–Ω–Ω—ã–µ –∏ 'body_text' –≤ –º–æ–∏_–¥–∞–Ω–Ω—ã–µ –µ—â–µ []
        comp_bi = [process_text(p['body_text'], –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, 2) –¥–ª—è –ø –≤ –∫–æ–º–ø_–¥–∞–Ω–Ω—ã–µ]
        all_bi = –Ω–∞–±–æ—Ä
        –¥–ª—è —Å –≤ comp_bi: all_bi.update(c)
        bi_freqs = –°—á–µ—Ç—á–∏–∫()
        –¥–ª—è —Å –≤ –∫–æ–º–ø_–±–∏:
            –¥–ª—è –±_ –≤ –Ω–∞–±–æ—Ä(c): bi_freqs[b_] += 1

     
        –¥–ª—è –±–≥ –≤ –∞–ª—å–±–µ
            df = the_freeqs[bg]
            –µ—Å–ª–∏ –¥—Ñ < 2 –∏ –±–≥ –Ω–µ—Ç –≤ –º–æ–π_–±–∏: –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
            my_c = my_bi.count(–±–≥)
            comp_c = [c.count(bg) –¥–ª—è —Å –≤ –∫–æ–º–ø_–¥–æ–∫—É–º–µ–Ω—Ç—ã –µ—Å–ª–∏ '—Ç–µ–ª–æ' –≤ —Å]
            med_c = np.median(comp_c) –µ—Å–ª–∏ –∫–æ–º–ø_—Å –µ—â–µ 0
     
            –µ—Å–ª–∏ —Å_—Å > 0 –∏–ª–∏ –º–æ–π_—Å > 0:
                table_ngrams.append({
                    "N-–≥—Ä–∞–º–º–∞": –±–≥, "–ö–æ–ª-–≤–æ —Å–∞–π—Ç–æ–≤": –¥—Ñ, "–ú–µ–¥–∏–∞–Ω–Ω–æ–µ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ": —Å_—Å,
                    "–°—Ä–µ–¥–Ω–µ–µ": –∫—Ä—É–≥–ª—ã–π(np.mean(comp_c) –µ—Å–ª–∏ –∫–æ–º–ø_—Å –µ—â–µ 0, 1), "–ù–∞ —Å–∞–π—Ç–µ": –º–æ–π_—Å,
              
                    ¬´–¢–§-–ò–î–§¬ª: –∫—Ä—É–≥–ª—ã–π(my_c * math.log(N/df –µ—Å–ª–∏ –¥—Ñ>0 –µ—â–µ 1), 3)
                })

    —Ç–∞–±–ª–∏—Ü–∞_rel = []
    –¥–ª—è —è, –ø –≤ –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å(–∫–æ–º–ø_–¥–∞–Ω–Ω—ã–µ):
        p_lemmas =process_text(p['body_text'], –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        —à = —Ç–æ–ª—å–∫–æ(–Ω–∞–±–æ—Ä(p_lemmas).–ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ(—Å–ª–æ–≤–∞—Ä—å))
        table_rel.append({
            "–î–æ–º–µ–Ω": –ø['–¥–æ–º–µ–Ω'], "–ü–æ–∑–∏—Ü–∏—è": —è+1, "URL": –ø['URL-–∞–¥—Ä–µ—Å'],
          
            "–®–∏—Ä–∏–Ω–∞": –í, "–ì–ª—É–±–∏–Ω–∞": —Ç–æ–ª—å–∫–æ(–ø_–ª–µ–º–º—ã)
        })
        
    –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è {
        "–≥–ª—É–±–∏–Ω–∞": pd.DataFrame(table_–≥–ª—É–±–∏–Ω–∞), "–≥–∏–±—Ä–∏–¥–Ω—ã–π": pd.DataFrame(table_hybrid),
        "–Ω–≥—Ä–∞–º–º—ã": pd.DataFrame(table_ngrams), "relevance_top": pd.DataFrame(table_rel),
        "–º–æ–π_—Å—á–µ—Ç": {"—à–∏—Ä–∏–Ω–∞": —Ç–æ–ª—å–∫–æ(–Ω–∞–±–æ—Ä(my_lemmas).intersection(vocab)), "–≥–ª—É–±–∏–Ω–∞": —Ç–æ–ª—å–∫–æ(my_lemmas)}
    }

# ==========================================
# 3. –ò–ù–¢–ï–†–§–ï–ô–°
# ==========================================

# --- –û–°–ù–û–í–ù–û–ô –ú–ê–ö–ï–¢ ---
col_main, col_sidebar = st.columns([65, 35]) 

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª—é—á–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –≤–≤–æ–¥–∞ URL-–æ–≤, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
–µ—Å–ª–∏ 'manual_urls_area_run' –Ω–µ—Ç –≤ st.session_state:
    st.session_state.manual_urls_area_run = ""

# --- –õ–ï–í–ê–Ø –ö–û–õ–û–ù–ö–ê ---
—Å col_main:
    
    —É–ª.–∑–∞–≥–æ–ª–æ–≤–æ–∫("SEO –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏")

    –µ—Å–ª–∏ 'start_ana–∞–Ω–∞–ª–∏–∑_—Ñ–ª–∞–≥' –Ω–µ—Ç –≤ st.session_state:
        st.session_state.start_ana–∞–Ω–∞–ª–∏–∑_flag = –õ–û–ñ–¨

    # 1. URL –∏–ª–∏ –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    —Å—Ç.—É—Ü–µ–Ω–∫–∞("### URL –∏–ª–∏ –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –í–∞—à–µ–≥–æ —Å–∞–π—Ç–∞")
    my_input_type = st.radio(
        "–¢–∏–ø —Å—Ç—Ä–∞–Ω–∏—Ü—ã", 
        ["–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ", "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ç–µ–∫—Å—Ç", "–ë–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"], 
        –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π=–ò—Å—Ç–∏–Ω–Ω—ã–π,
        label_visibility="—Ä—É—Ö–Ω—É–ª",
        –∫–ª—é—á ="my_page_source_radio"
    )

    –º–æ–π_url = ""
    –º–æ—è_—Å—Ç—Ä–∞–Ω–∏—Ü–∞_–∫–æ–Ω—Ç–µ–Ω—Ç = ""

    –µ—Å–ª–∏ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ":
        # –° –ó–ê–°–¢–ê–í–©–ò–ö
        my_url = st.text_input(
            "URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã", 
            –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å ="https://site.ru/catalog/tovar", 
            label_visibility="—Ä—É—Ö–Ω—É–ª", 
            –∫–ª—é—á ="–º–æ–π_url_input"
        )
    
    –≠–ª–∏—Ñ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ç–µ–∫—Å—Ç":
        my_page_content = st.text_area("–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏–ª–∏ —Ç–µ–∫—Å—Ç", –≤—ã—Å–æ—Ç–∞=200, label_visibility="—Ä—É—Ö–Ω—É–ª", –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å="–í—Å—Ç–∞–≤—å—Ç–µ HTML-–∫–æ–¥ –∏–ª–∏ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã", –∫–ª—é—á="–º–æ–π_–∫–æ–Ω—Ç–µ–Ω—Ç_–≤—Ö–æ–¥")
    –≠–ª–∏—Ñ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–ë–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã":
        st.info("–í—ã–±—Ä–∞–Ω –∞–Ω–∞–ª–∏–∑ –±–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞.")

    # 2. –ü–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å
    —Å—Ç.—É—Ü–µ–Ω–∫–∞("### –ü–æ–∏—Å–∫–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å")
    # –° –ó–ê–°–¢–ê–í–©–ò–ö
    –∑–∞–ø—Ä–æ—Å = st.text_input(
        "–û—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å", 
        –∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—å ="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫—É–ø–∏—Ç—å –ø–ª–∞—Å—Ç–∏–∫–æ–≤—ã–µ –æ–∫–Ω–∞", 
        label_visibility="—Ä—É—Ö–Ω—É–ª", 
        –∫–ª—é—á ="–∑–∞–ø—Ä–æ—Å_–≤—Ö–æ–¥"
    )
    —É–ª.—á–µ–∫–±–æ–∫—Å("–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã", –æ—Ç–∫–ª—é—á–µ–Ω=–ò—Å—Ç–∏–Ω–Ω—ã–π, –∑–Ω–∞—á–µ–Ω–∏–µ=–õ–û–ñ–¨)

    # 3. –ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ (–ò–ó–ú–ï–ù–ï–ù–û)
    —Å—Ç.—É—Ü–µ–Ω–∫–∞("### –ü–æ–∏—Å–∫ –∏–ª–∏ URL —Å—Ç—Ä–∞–Ω–∏—Ü –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤")
    
    # –í–∏–¥–∂–µ—Ç radio –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã
    source_type_new = st.radio(
        "–ò—Å—Ç–æ—á–Ω–∏–∫ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤", 
        ["–ü–æ–∏—Å–∫ (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –¢–û–ü)", "–†—É—á–Ω–æ–π —Å–ø–∏—Å–æ–∫ URL (–ù–∞–∂–º–∏—Ç–µ –Ω–∏–∂–µ)"], # –ò–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è —è—Å–Ω–æ—Å—Ç–∏
        –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π=–õ–û–ñ–¨,
        label_visibility="—Ä—É—Ö–Ω—É–ª",
        –∫–ª—é—á ="–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç_–∏—Å—Ç–æ—á–Ω–∏–∫_—Ä–∞–¥–∏–æ"
    )
    
    –∏—Å—Ö–æ–¥–Ω—ã–π_—Ç–∏–ø = "Google (–ê–≤—Ç–æ)" –µ—Å–ª–∏ source_type_new == "–ü–æ–∏—Å–∫ (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–±–æ—Ä –¢–û–ü)" –µ—â–µ "–†—É—á–Ω–æ–π —Å–ø–∏—Å–æ–∫" 
    
    # –í–∏–¥–∂–µ—Ç expander –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ URL (—Ä–µ–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É —Ä–∞—Å–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è)
    –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π_—Ç–∏–ø == "–†—É—á–Ω–æ–π —Å–ø–∏—Å–æ–∫":
        # Expander, —Å—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ "–ø–æ–ª–µ"
        —Å —É–ª.—Ä–∞—Å—à–∏—Ä–∏—Ç–µ–ª—å("–°–ø–∏—Å–æ–∫ url-–∞–¥—Ä–µ—Å–æ–≤ –≤–∞—à–∏—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤", —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–π=–ò—Å—Ç–∏–Ω–Ω—ã–π, –∫–ª—é—á="competitor_urls_expander"):
            # –ü–æ–ª–µ –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º key –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –≤ session_state –≤ –ª–æ–≥–∏–∫–µ –∑–∞–ø—É—Å–∫–∞
            st.text_area(
                "–í–≤–µ–¥–∏—Ç–µ URL-–∞–¥—Ä–µ—Å–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤, –∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏:",
                –≤—ã—Å–æ—Ç–∞=200,
                –∫–ª—é—á ="manual_urls_area_run" 
            )
            —É–ª.–ø–æ–¥–ø–∏—Å—å("–î–∞–Ω–Ω–æ–µ –ø–æ–ª–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫, –∫–∞–∫ –≤—ã –∏ –ø—Ä–æ—Å–∏–ª–∏.")
            
    # --- 4. –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —Å–ø–∏—Å–∫–∏ (–û—Å—Ç–∞–≤–ª–µ–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
    —Å—Ç.—É—Ü–µ–Ω–∫–∞("### –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º—ã–µ —Å–ø–∏—Å–∫–∏")

    # –ù–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã
    –∏—Å–∫–ª—é—á–∞–µ—Ç = st.text_area("–ù–µ —É—á–∏—Ç—ã–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)", DEFAULT_EXCLUDE, –≤—ã—Å–æ—Ç–∞=200, –∫–ª—é—á="settings_excludes")
    —É–ª.–ø–æ–¥–ø–∏—Å—å("–î–æ–º–µ–Ω—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–∫–ª—é—á–µ–Ω—ã –∏–∑ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤.")

    # –°—Ç–æ–ø-—Å–ª–æ–≤–∞
    c_stops = st.text_area("–°—Ç–æ–ø-—Å–ª–æ–≤–∞ (–∫–∞–∂–¥–æ–µ —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)", DEFAULT_STOPS, –≤—ã—Å–æ—Ç–∞=200, –∫–ª—é—á="settings_stops")
    —É–ª.–ø–æ–¥–ø–∏—Å—å("–°–ª–æ–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –ø–µ—Ä–µ–¥ –ª–µ–º–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π.")

    # 5. –ö–ù–û–ü–ö–ê
    —Å—Ç.—É—Ü–µ–Ω–∫–∞("---")
   
    –µ—Å–ª–∏ st.–∫–Ω–æ–ø–∫–∞("–ó–ê–ü–£–°–¢–ò–¢–¨ –ê–ù–ê–õ–ò–ó", —Ç–∏–ø="–Ω–∞—á–∞–ª—å–Ω—ã–π", use_container_width=–ò—Å—Ç–∏–Ω–Ω—ã–π, –∫–ª—é—á="start_ana–∞–Ω–∞–ª–∏–∑_btn"):
        st.session_state.start_ana–∞–Ω–∞–ª–∏–∑_flag = –ò—Å—Ç–∏–Ω–Ω—ã–π

# --- –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê ---
—Å col_sidebar:
    —Å —É–ª.–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä(): 
        —Å—Ç.—É—Ü–µ–Ω–∫–∞("#####‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")

        —Å—Ç.—É—Ü–µ–Ω–∫–∞("###### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã")
        ua = st.selectbox(¬´–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–ê–≥–µ–Ω—Ç¬ª, [¬´Mozilla/5.0 (Windows NT 10.0; Win64; x64)¬ª, ¬´–Ø–Ω–¥–µ–∫—Å–ë–æ—Ç/3.0¬ª], –∫–ª—é—á="settings_ua")
        —É–ª.–ø–æ–¥–ø–∏—Å—å("–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞.")
        
        search_engine = st.selectbox("–ü–æ–∏—Å–∫–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞", ["Google", "–Ø–Ω–¥–µ–∫—Å", "–Ø–Ω–¥–µ–∫—Å + Google"], –∫–ª—é—á="settings_search_engine")
        —Ä–µ–≥–∏–æ–Ω = st.selectbox("–Ø–Ω–¥–µ–∫—Å / –†–µ–≥–∏–æ–Ω", –†–ï–ì–ò–û–ù–´, –∫–ª—é—á="settings_region")
        —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ = st.selectbox("–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ", [¬´–î–µ—Å–∫—Ç–æ–ø¬ª, ¬´–ú–æ–±–∏–ª—å–Ω—ã–π¬ª], –∫–ª—é—á="settings_device")
        top_n = st.selectbox("–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¢–û–ü", [10, 20, 30], –∏–Ω–¥–µ–∫—Å=1, –∫–ª—é—á="settings_top_n")
        st.selectbox("–£—á–∏—Ç—ã–≤–∞—Ç—å —Ç–∏–ø —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ url", ["–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã", "–ì–ª–∞–≤–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã", 
        "–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã"], –∫–ª—é—á="settings_url_type")
        st.selectbox("–£—á–∏—Ç—ã–≤–∞—Ç—å —Ç–∏–ø", ["–í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã", "–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ", "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ"], –∫–ª—é—á="settings_content_type")
        
        # --- –î–£–ë–õ–ò –£–î–ê–õ–ï–ù–´ ---
        
        —Å—Ç.—É—Ü–µ–Ω–∫–∞("###### –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏")
        col_check1_s, col_check2_s = st.columns(2)
        —Å col_check1_s:
            —É–ª.—á–µ–∫–±–æ–∫—Å("–ò—Å–∫–ª—é—á–∞—Ç—å noindex/script/style/head/footer/nav", –ò—Å—Ç–∏–Ω–Ω—ã–π, –∫–ª—é—á="settings_noindex")
            
            —É–ª.—á–µ–∫–±–æ–∫—Å("–£—á–∏—Ç—ã–≤–∞—Ç—å Alt/Title", –õ–û–ñ–¨, –∫–ª—é—á="settings_alt")
            —É–ª.—á–µ–∫–±–æ–∫—Å("–£—á–∏—Ç—ã–≤–∞—Ç—å —á–∏—Å–ª–∞ (0-9)", –õ–û–ñ–¨, –∫–ª—é—á="settings_numbers")
        —Å col_check2_s:
            —É–ª.—á–µ–∫–±–æ–∫—Å("–ù–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ –¥–ª–∏–Ω–µ (LSA/BM25)", –ò—Å—Ç–∏–Ω–Ω—ã–π, –∫–ª—é—á="settings_norm")
            —É–ª.—á–µ–∫–±–æ–∫—Å("–ò—Å–∫–ª—é—á–∞—Ç—å –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—ã/–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å—ã –≤ –ø–æ–∏—Å–∫–µ (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)", –ò—Å—Ç–∏–Ω–Ω—ã–π, –∫–ª—é—á="settings_agg")


# ==========================================
# 4. –õ–û–ì–ò–ö–ê –ó–ê–ü–£–°–ö–ê (–ò–ó–ú–ï–ù–ï–ù–û)
# ==========================================
–µ—Å–ª–∏ st.session_state.start_ana–ª–∏–∑_flag:
    st.session_state.start_ana–∞–Ω–∞–ª–∏–∑_flag = –õ–û–ñ–¨

    –µ—Å–ª–∏ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ" –∏ –Ω–µ—Ç st.session_state.get('–º–æ–π_url_input'):
        —É–ª.–æ—à–∏–±–∫–∞("–í–≤–µ–¥–∏—Ç–µ URL!")
   
        —Å—Ç.—Å—Ç–æ–ø()
        
    –µ—Å–ª–∏ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ç–µ–∫—Å—Ç" –∏ –Ω–µ—Ç st.session_state.get('–º–æ–π_–∫–æ–Ω—Ç–µ–Ω—Ç_–≤—Ö–æ–¥', '').strip():
        —É–ª.–æ—à–∏–±–∫–∞("–í–≤–µ–¥–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏–ª–∏ —Ç–µ–∫—Å—Ç!")
        —Å—Ç.—Å—Ç–æ–ø()
    
    –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π_—Ç–∏–ø == "Google (–ê–≤—Ç–æ)" –∏ st.session_state.settings_search_engine != "Google":
        —Å—Ç.–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ(f"–ê–Ω–∞–ª–∏–∑ –¢–û–ü-–∞ –¥–ª—è **{st.session_state.settings_search_engine}** –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.
        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Google Search.")
        –µ—Å–ª–∏ –Ω–µ—Ç st.session_state.get('query_input'):
            —É–ª.–æ—à–∏–±–∫–∞("–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤!")
            —Å—Ç.—Å—Ç–æ–ø()
            
    –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π_—Ç–∏–ø == "–†—É—á–Ω–æ–π —Å–ø–∏—Å–æ–∫" –∏ –Ω–µ—Ç st.session_state.manual_urls_area_run.strip():
        —É–ª.–æ—à–∏–±–∫–∞("–í—ã–±—Ä–∞–Ω —Ä—É—á–Ω–æ–π –≤–≤–æ–¥, –Ω–æ —Å–ø–∏—Å–æ–∫ URL –ø—É—Å—Ç!")
        —Å—Ç.—Å—Ç–æ–ø()


    –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ = {
        '–Ω–æ–∏–Ω–¥–µ–∫—Å': st.session_state.settings_noindex, 
        'alt_title': st.session_state.settings_alt, 
        '—Ü–∏—Ñ—Ä—ã': st.session_state.settings_numbers,
        '–Ω–æ—Ä–º–∞': st.session_state.settings_norm, 
        '–¥–µ–ª–∞—Ç—å': st.session_state.settings_ua, 
     
        'custom_stops': st.session_state.settings_stops.split()
    }
    
    target_urls = []
    –µ—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π_—Ç–∏–ø == "Google (–ê–≤—Ç–æ)":
        –∏—Å–∫–ª—é—á–∞—è = [d.strip() –¥–ª—è –¥ –≤ st.session_state.settings_excludes.split('\n') –µ—Å–ª–∏ d.strip()]
        –µ—Å–ª–∏ st.session_state.settings_agg: excl.extend(["–¥–µ–¥—É—à–∫–∞", "–æ–∑–æ–Ω", "–ª–µ—Å–Ω—ã–µ —è–≥–æ–¥—ã", "—Ä—ã–Ω–æ–∫", "–í–æ–Ω —Ç–æ—Ç", "—é—Ç—É–±"])
        
        –ø—ã—Ç–∞—Ç—å—Å—è:
            —Å —É–ª.—Å–ø–∏–Ω–Ω–µ—Ä(f"–°–±–æ—Ä –¢–û–ü–∞ {st.session_state.settings_search_engine}..."):
            
                –µ—Å–ª–∏ –Ω–µ—Ç USE_SEARCH:
                    —É–ª.–æ—à–∏–±–∫–∞("–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ 'googlesearch' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
                    —Å—Ç.—Å—Ç–æ–ø()

                –Ω–∞–π–¥–µ–Ω–æ = –ø–æ–∏—Å–∫ (st.session_state.query_input, num_results=st.session_state.settings_top_n * 2, —Ç–æ–ª—å–∫–æ="—Ä—É")
                cnt = 0
           
                –¥–ª—è –≤ –≤ –Ω–∞–π–¥–µ–Ω–Ω—ã–π:
                    –µ—Å–ª–∏ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ" –∏ st.session_state.my_url_input –≤ –≤: –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
                    –µ—Å–ª–∏ –ª—é–±–æ–π(—Ö –≤ urlparse(u).netloc –¥–ª—è —Ö –≤ –∏—Å–∫–ª—é—á–∞—è): –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å
                    target_urls.append(u)
            
                    –ö–ü–¢ += 1
                    –µ—Å–ª–∏ cnt >= st.session_state.settings_top_n: –ø–µ—Ä–µ—Ä—ã–≤
        –∫—Ä–æ–º–µ –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∫ –µ:
            —É–ª.–æ—à–∏–±–∫–∞(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ: {–∏}")
            —Å—Ç.—Å—Ç–æ–ø()
            
    # –ò–ó–ú–ï–ù–ï–ù–û: –ß–∏—Ç–∞–µ–º –∏–∑ session_state, —Ç–∞–∫ –∫–∞–∫ –≤–∏–¥–∂–µ—Ç —Å–æ–∑–¥–∞–Ω –≤ —Å–µ–∫—Ü–∏–∏ –ò–ù–¢–ï–†–§–ï–ô–°
    –µ—â–µ: 
        target_urls = [u.strip() –¥–ª—è –≤ –≤ st.session_state.manual_urls_area_run.split('\n') –µ—Å–ª–∏ u.strip()]

    –µ—Å–ª–∏ –Ω–µ—Ç —Ü–µ–ª–µ–≤—ã–µ_urls:
        —É–ª.–æ—à–∏–±–∫–∞("–ù–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.")
        —Å—Ç.—Å—Ç–æ–ø()
        
    –º–æ–∏_–¥–∞–Ω–Ω—ã–µ = –ù–∏–∫—Ç–æ
    –µ—Å–ª–∏ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ":
        –ø—Ä–æ–≥ = st.progress(0.0)
        —Å—Ç–∞—Ç—É—Å = —Å—Ç.–ø—É—Å—Ç–æ–π()
        —Å—Ç–∞—Ç—É—Å.—Ç–µ–∫—Å—Ç("–°–∫–∞—á–∏–≤–∞–µ–º –≤–∞—à —Å–∞–π—Ç...")
        my_data = parse_page(st.session_state.my_url_input, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
        –ø—Ä–æ–≥.–ø—Ä–æ–≥—Ä–µ—Å—Å(0.05)
        –µ—Å–ª–∏ –Ω–µ—Ç –º–æ–∏_–¥–∞–Ω–Ω—ã–µ:
            —É–ª.–æ—à–∏–±–∫–∞("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∞–π—Ç—É.
            –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏–ª–∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ '–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥'.")
            —Å—Ç.—Å—Ç–æ–ø()
        –ø—Ä–æ–≥.–ø—É—Å—Ç–æ–π()
        —Å—Ç–∞—Ç—É—Å.–ø—É—Å—Ç–æ–π()
    –≠–ª–∏—Ñ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø == "–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —Ç–µ–∫—Å—Ç":
        –º–æ–∏_–¥–∞–Ω–Ω—ã–µ = {
            'URL-–∞–¥—Ä–µ—Å': ¬´–ú–µ—Å—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç¬ª, 
            '–¥–æ–º–µ–Ω': '–ª–æ–∫–∞–ª—å–Ω—ã–π.–∫–æ–Ω—Ç–µ–Ω—Ç', 
            'body_text': st.session_state.my_content_input, 
   
            'anchor_text': '' 
        }
    
    –∫–æ–º–ø_–¥–∞–Ω–Ω—ã–µ = []
    —Å concurrent.futures.ThreadPoolExecutor(max_workers=5) –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:
        Futures = {executor.submit(parse_page, u, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏): u –¥–ª—è –≤ –≤ target_urls}
        —Å–¥–µ–ª–∞–Ω–æ = 0
        total_tasks = —Ç–æ–ª—å–∫–æ(target_urls)
        prog_comp = st.progress(0)
        status_comp = st.empty()
       
  
        –¥–ª—è –∂ –≤ concurrent.futures.as_completed(—Ñ—å—é—á–µ—Ä—Å—ã):
            —Ä–µ–∑ = f.result()
            –µ—Å–ª–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: comp_data.append(—Ä–µ–∑)
            –≥–æ—Ç–æ–≤–æ += 1
            prog_comp.progress(—Å–¥–µ–ª–∞–Ω–æ/–æ–±—â–µ–µ_–∑–∞–¥–∞—á)
            status_comp.text(f"–ü—Ä—ã–∂–æ–∫ {—Å–¥–µ–ª–∞–Ω–Ω—ã–π} –∏–∑ {total_tasks} –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤...")
            
    
    prog_comp.empty()
    status_comp.empty()
    
    –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ(comp_data) < 2 –∏ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø != "–ë–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã":
        —Å—Ç.–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ(f"–ú–∞–ª–æ –¥–∞–Ω–Ω—ã—Ö –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ (–º–µ–Ω–µ–µ 2).
        –ü—Ä–æ–¥–æ–ª–∂–∞—é —Å {—Ç–æ–ª—å–∫–æ(comp_data)} –¥–∞–Ω–Ω—ã–º–∏.")

    –µ—Å–ª–∏ –Ω–µ—Ç –º–æ–∏_–¥–∞–Ω–Ω—ã–µ –∏ –º–æ–π_–≤—Ö–æ–¥–Ω–æ–π_—Ç–∏–ø != "–ë–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã":
         —É–ª.–æ—à–∏–±–∫–∞("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.")
         —Å—Ç.—Å—Ç–æ–ø()
         
    —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã = Calculate_metrics (comp_data, my_data, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
    —É–ª.—É—Å–ø–µ—Ö("–ì–æ—Ç–æ–≤–æ! –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∏–∂–µ.")
    
    —Å —Ä—É—á–Ω–æ–π_–≤–æ—Ä–æ—Ç–Ω–∏–∫:
        –µ—Å–ª–∏ –º–æ–∏_–¥–∞–Ω–Ω—ã–µ –∏ —Ç–æ–ª—å–∫–æ(comp_data) > 0:
            —Å—Ç.—É—Ü–µ–Ω–∫–∞("### 1. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≥–ª—É–±–∏–Ω–µ")
  
            df_d = —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã['–≥–ª—É–±–∏–Ω–∞']
            –µ—Å–ª–∏ –Ω–µ—Ç df_d.–ø—É—Å—Ç–æ–π:
                df_d = df_d.sort_values(by="diff_abs", –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é=–õ–û–ñ–¨)
                
                rows_per_page = 20
                –≤—Å–µ–≥–æ_—Å—Ç—Ä–æ–∫ = —Ç–æ–ª—å–∫–æ(df_d)
   
                total_pages = math.ceil(total_rows / rows_per_page)
                
                –µ—Å–ª–∏ '–Ω–æ–º–µ—Ä_—Å—Ç—Ä–∞–Ω–∏—Ü—ã' –Ω–µ—Ç –≤ st.session_state: st.session_state.page_number = 1
                
                col_p1, col_p2, col_p3 = st.columns([1, 3, 1])
      
                —Å —Å—Ç–æ–ª–±–µ—Ü_p1:
                    –µ—Å–ª–∏ st.–∫–Ω–æ–ø–∫–∞("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", –∫–ª—é—á="prev_page_button") –∏ st.session_state.page_number > 1:
                        st.session_state.page_number -= 1
                —Å —Å—Ç–æ–ª–±–µ—Ü_p2:
                   
                    —Å—Ç.—É—Ü–µ–Ω–∫–∞(f"<div style='text-align: center; padding-top: 10px; color: {TEXT_COLOR};'>–°—Ç—Ä–∞–Ω–∏—Ü–∞ <b>{st.session_state.page_number}</b> –∏–∑ {total_pages}</div>", unsafe_allow_html=–ò—Å—Ç–∏–Ω–Ω—ã–π)
                —Å col_p3:
                    –µ—Å–ª–∏ st.–∫–Ω–æ–ø–∫–∞("–í–ø–µ—Ä–µ–¥ ‚û°Ô∏è", –∫–ª—é—á="–∫–Ω–æ–ø–∫–∞ —Å–ª–µ–¥—É—é—â–µ–π_—Å—Ç—Ä–∞–Ω–∏—Ü—ã") –∏ st.session_state.page_number < –≤—Å–µ–≥–æ_—Å—Ç—Ä–∞–Ω–∏—Ü:
                        st.session_state.page_number += 1
                   
            
                start_idx = (st.session_state.page_number - 1) * —Å—Ç—Ä–æ–∫_–Ω–∞_—Å—Ç—Ä–∞–Ω–∏—Ü—É
                end_idx = start_idx + rows_per_page
                df_page = df_d.iloc[start_idx:end_idx]
                
               
                st.dataframe(df_page, columns_config={"diff_abs": –ù–∏–∫—Ç–æ}, use_container_width=–ò—Å—Ç–∏–Ω–Ω—ã–π, –≤—ã—Å–æ—Ç–∞=800)
                st.download_button("–°–∫–∞—á–∞—Ç—å –í–°–Æ —Ç–∞–±–ª–∏—Ü—É (CSV)", df_d.to_csv().encode('utf-8'), "–≥–ª—É–±–∏–Ω–∞.csv")
                
                —Å —É–ª.—Ä–∞—Å—à–∏—Ä–∏—Ç–µ–ª—å("2. –ì–∏–±—Ä–∏–¥–Ω—ã–π –¢–û–ü"):
                    st.dataframe(—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã['–≥–∏–±—Ä–∏–¥–Ω—ã–π'].sort_values(–ø–æ="TF-IDF –¢–û–ü", –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é=–õ–û–ñ–¨), use_container_width=–ò—Å—Ç–∏–Ω–Ω—ã–π)
                
                
                —Å —É–ª.—Ä–∞—Å—à–∏—Ä–∏—Ç–µ–ª—å("3. N-–≥—Ä–∞–º–º—ã"):
                    st.dataframe(—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã['–Ω–≥—Ä–∞–º–º'].sort_values(–ø–æ=¬´–¢–§-–ò–î–§¬ª, –ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é=–õ–û–ñ–¨), use_container_width=–ò—Å—Ç–∏–Ω–Ω—ã–π)

            
            —Å —É–ª.—Ä–∞—Å—à–∏—Ä–∏—Ç–µ–ª—å("4. –¢–û–ü —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏"):
                st.dataframe(—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã['relevance_top'], use_container_width=–ò—Å—Ç–∏–Ω–Ω—ã–π)

            –µ—Å–ª–∏ –Ω–µ—Ç –º–æ–∏_–¥–∞–Ω–Ω—ã–µ:
                —Å—Ç.–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ("–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è, 
                —Ç–∞–∫ –∫–∞–∫ –±—ã–ª –≤—ã–±—Ä–∞–Ω —Ä–µ–∂–∏–º '–ë–µ–∑ —Å—Ç—Ä–∞–Ω–∏—Ü—ã'.")
