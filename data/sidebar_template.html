<div class="page-content-with-sidebar">
    <button id="mobile-menu-toggle" class="menu-toggle-button">
        ☰
    </button>

    <div class="sidebar-wrapper">
        <nav id="sidebar-menu">
            <ul class="list-unstyled components">
                <!-- СЮДА ВСТАВИТСЯ МЕНЮ ИЗ PYTHON -->
                {{GENERATED_MENU_ITEMS}}
            </ul>
        </nav>
    </div>
</div>

<style>
    :root { font-size: 14px; }
    @media (min-width: 2201px) { font-size: 16px; }
    
    #sidebar-menu ul, #sidebar-menu li { list-style: none !important; margin: 0 !important; padding: 0 !important; }

    #sidebar-menu .list-unstyled a,
    #sidebar-menu .list-unstyled span.dropdown-toggle {
        font-size: 0.85em; padding: 0.5rem 0.5rem; padding-right: 1.5rem; display: block;
        text-decoration: none; color: #3D4858; transition: all 0.2s ease-in-out;
        position: relative; font-weight: 600; cursor: pointer;
    }
    
    #sidebar-menu .level-1-header > span.dropdown-toggle,
    #sidebar-menu .level-1-header > a { border-bottom: 1px solid #e9ecef; }

    #sidebar-menu .level-2-header > span.dropdown-toggle { padding-left: 1rem; }
    #sidebar-menu .level-3-link > a { padding-left: 2rem; color: #555; font-weight: 400; }
    
    #sidebar-menu .level-2-link-special { background: #F6F7FC; }
    #sidebar-menu .level-2-link-special > a { padding-left: 1rem; font-weight: 600; color: #3D4858; position: relative; padding-right: 1rem; }
    #sidebar-menu .level-2-link-special > a::after { content: none !important; }
    #sidebar-menu .level-2-link-special > a:hover { color: #277EFF; background: #EBF5FF; }
    
    #sidebar-menu .list-unstyled a:hover,
    #sidebar-menu .level-3-link a:hover,
    #sidebar-menu .list-unstyled span.dropdown-toggle:hover { color: #277EFF; background: #EBF5FF; }
    
    #sidebar-menu .level-1-header.active > span.dropdown-toggle,
    #sidebar-menu .level-2-header.active > span.dropdown-toggle { background: #F6F7FC; color: #277EFF; }
    
    #sidebar-menu .collapse-menu { list-style: none; padding: 0; background: #F6F7FC; display: none; }
    
    #sidebar-menu .dropdown-toggle::after {
        content: '▶'; position: absolute; right: 0.3rem; top: 50%; transform: translateY(-50%);
        transition: transform 0.3s; font-size: 0.7em; color: #999;
    }
    #sidebar-menu .dropdown-toggle.active::after { content: '▼'; transform: translateY(-50%) rotate(0deg); color: #277EFF; }
    
    #sidebar-menu .level-1-header > a::after { content: none !important; }

    .page-content-with-sidebar { margin-left: 0 !important; }
    .sidebar-wrapper { position: absolute; top: 0; left: 0; width: 1px; height: 1px; overflow: hidden; z-index: 1001; }
    #sidebar-menu, #sidebar-menu * { box-sizing: border-box; }

    .menu-toggle-button {
        position: fixed; top: 20px; right: 10px; background: #277EFF; color: white; border: none;
        padding: 5px 10px; font-size: 24px; line-height: 1; cursor: pointer; z-index: 1002;
        border-radius: 5px; display: none; transition: all 0.3s ease;
    }

    #sidebar-menu {
        z-index: 1000; background: #FFFFFF; color: #3D4858; transition: transform 0.3s ease;
        font-family: 'Open Sans', sans-serif; box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
        position: fixed; top: 0; left: 0; width: auto; max-width: 350px; height: 100vh;
        max-height: 100vh; transform: translateX(-100%); padding-top: 60px; border-radius: 0;
        display: block; overflow-y: auto;
    }

    #sidebar-menu.active { transform: translateX(0); }
    
    @media (max-width: 1800px) {
        .menu-toggle-button { display: block; top: 20px; }
        @media (min-width: 1180px) and (max-width: 1580px) {
            .menu-toggle-button { right: 183px; top: 30px; transition: right 0.3s ease, top 0.3s ease; }
        }
        #sidebar-menu .list-unstyled a, #sidebar-menu .list-unstyled span.dropdown-toggle {
            font-size: 16px !important; padding: 10px 15px !important; padding-right: 30px !important;
        }
        #sidebar-menu .level-2-header > span.dropdown-toggle { padding-left: 25px !important; }
        #sidebar-menu .level-3-link > a { padding-left: 40px !important; }
        #sidebar-menu .level-2-link-special > a { padding-left: 25px !important; padding-right: 25px !important; }
    }

    @media (max-width: 350px) {
        #sidebar-menu { width: 100%; max-width: 100%; }
        .menu-toggle-button { right: 5px; padding: 5px 8px; }
    }

    @media (min-width: 1801px) {
        #sidebar-menu { width: 14.28rem; }
        .page-content-with-sidebar { margin-left: 15.7rem; }
        .menu-toggle-button { display: none; }
        .sidebar-wrapper { position: static; width: auto; height: auto; overflow: visible; }
        #sidebar-menu {
            height: auto; position: fixed; top: calc(150px + 70px); left: 10px;
            max-height: calc(100vh - 250px - 70px); transform: translateX(0);
            padding-top: 0; box-shadow: 0 0 15px rgba(0, 0, 0, 0.05);
            border-radius: 10px; display: block; overflow-y: hidden;
        }
        #sidebar-menu .list-unstyled.components { max-height: calc(100vh - 250px - 70px); overflow-y: auto; }
        #sidebar-menu .level-1-header.active > span.dropdown-toggle,
        #sidebar-menu .level-2-header.active > span.dropdown-toggle { background: #FFFFFF !important; color: #3D4858; }
        #sidebar-menu .level-1-header:hover > span.dropdown-toggle,
        #sidebar-menu .level-2-header:hover > span.dropdown-toggle { background: #EBF5FF; color: #277EFF; }
        #sidebar-menu .level-2-link-special { background: #FFFFFF; }
        #sidebar-menu .level-2-link-special > a:hover { background: #EBF5FF; }
        #sidebar-menu .level-1-header > a:hover { background: #EBF5FF; color: #277EFF; }
    }
</style>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const menu = document.getElementById('sidebar-menu');
        const listComponents = menu ? menu.querySelector('.list-unstyled.components') : null;
        const mobileToggle = document.getElementById('mobile-menu-toggle'); 
        if (!menu || !listComponents || !mobileToggle) return; 

        const toggles = menu.querySelectorAll('.dropdown-toggle');
        const desktopBreakpoint = 1801;

        function resetMenuState() {
            menu.querySelectorAll('.collapse-menu').forEach(sub => { sub.style.display = 'none'; });
            menu.querySelectorAll('.level-1-header, .level-2-header').forEach(li => {
                li.classList.remove('active');
                const toggle = li.querySelector('.dropdown-toggle');
                if(toggle) toggle.classList.remove('active');
            });
        }

        function handleResize() {
            if (window.innerWidth >= desktopBreakpoint) {
                menu.classList.remove('active');
                if (mobileToggle) mobileToggle.textContent = '☰';
                resetMenuState();
            }
        }
        handleResize();
        window.addEventListener('resize', handleResize);

        if (mobileToggle) {
            mobileToggle.addEventListener('click', function() {
                if (window.innerWidth < desktopBreakpoint) {
                    menu.classList.toggle('active');
                    if (menu.classList.contains('active')) { this.textContent = '✖'; } else { this.textContent = '☰'; }
                }
            });
        }
        
        menu.querySelectorAll('a').forEach(link => {
            if (link.closest('.level-3-link') || link.closest('.level-2-link-special') || link.parentElement.classList.contains('level-1-header')) {
                link.addEventListener('click', function() {
                    if (window.innerWidth < desktopBreakpoint) {
                        menu.classList.remove('active');
                        if (mobileToggle) mobileToggle.textContent = '☰';
                    }
                });
            }
        });

        toggles.forEach(toggle => {
            toggle.addEventListener('click', function(event) {
                event.preventDefault();
                const parentLi = this.parentElement;
                const parentUl = parentLi.parentElement;
                const targetMenu = parentLi.querySelector('.collapse-menu');
                if (!targetMenu) return;
                const isActive = parentLi.classList.contains('active');
                const activeSiblings = parentUl.querySelectorAll('.level-1-header.active, .level-2-header.active');
                activeSiblings.forEach(sibling => {
                    if (sibling !== parentLi) {
                        sibling.classList.remove('active');
                        const siblingToggle = sibling.querySelector('.dropdown-toggle');
                        if (siblingToggle) siblingToggle.classList.remove('active');
                        const siblingMenu = sibling.querySelector('.collapse-menu');
                        if (siblingMenu) siblingMenu.style.display = 'none';
                    }
                });
                parentLi.classList.toggle('active', !isActive);
                this.classList.toggle('active', !isActive);
                if (!isActive) { targetMenu.style.display = 'block'; } else { targetMenu.style.display = 'none'; }
            });
        });
    });
</script>
